#!/bin/bash

[ -s "$PWD/config" ] || \
(echo 'From the script directory, run: db/dboss/import_descriptions'; exit)
. $PWD/config # import config

FILTER="${DIRECTORY[script]}/filter/sf/description.xsl"

for FILE in ${DIRECTORY[data]}/pages/sforge/*; do
  [ -s "$FILE" ] || continue
  ID=$(basename "$FILE" '.html')
  DESCRIPTION=$(xsltproc --html $FILTER $FILE 2> /dev/null | sed "s/'/''/g")
  [ -n "$DESCRIPTION" ] || continue
  
  echo "update or ignore Projects set description = '$DESCRIPTION' where name = '$ID';"
done

